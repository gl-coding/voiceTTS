{% extends 'base.html' %}

{% block title %}首页 - 英文语音生成{% endblock %}

{% block content %}
<div class="main-container">
    <div class="text-center mb-4">
        <h1 class="text-gradient">
            <i class="bi bi-mic-fill"></i> 英文文本转语音
        </h1>
        <p class="text-muted">支持本地生成和云服务生成，自动上传到对象存储</p>
    </div>

    <div class="row">
        <div class="col-lg-8 mx-auto">
            <div class="card p-4">
                <form method="post" action="{% url 'generate_tts' %}" id="ttsForm">
                    {% csrf_token %}
                    
                    <!-- 文本输入 -->
                    <div class="mb-4">
                        <label for="{{ form.text.id_for_label }}" class="form-label">
                            <i class="bi bi-chat-text"></i> {{ form.text.label }}
                        </label>
                        {{ form.text }}
                        <div class="form-text">{{ form.text.help_text }}</div>
                        {% if form.text.errors %}
                            <div class="text-danger mt-2">
                                {{ form.text.errors }}
                            </div>
                        {% endif %}
                    </div>

                    <!-- 生成方式选择 -->
                    <div class="mb-4">
                        <label class="form-label">
                            <i class="bi bi-gear"></i> {{ form.tts_type.label }}
                        </label>
                        <div class="row">
                            {% for radio in form.tts_type %}
                                <div class="col-md-6">
                                    <div class="card p-3 mb-2">
                                        <div class="form-check">
                                            {{ radio.tag }}
                                            <label class="form-check-label" for="{{ radio.id_for_label }}">
                                                {% if radio.choice_label == '本地生成' %}
                                                    <i class="bi bi-laptop"></i> <strong>本地生成</strong>
                                                    <br><small class="text-muted">使用本地TTS模型，速度较快</small>
                                                {% else %}
                                                    <i class="bi bi-cloud"></i> <strong>云服务生成</strong>
                                                    <br><small class="text-muted">使用火山引擎TTS，音质更好</small>
                                                {% endif %}
                                            </label>
                                        </div>
                                    </div>
                                </div>
                            {% endfor %}
                        </div>
                    </div>

                    <!-- URL有效期选择 -->
                    <div class="mb-4">
                        <label for="{{ form.expire_time.id_for_label }}" class="form-label">
                            <i class="bi bi-clock-history"></i> {{ form.expire_time.label }}
                        </label>
                        {{ form.expire_time }}
                        <div class="form-text">{{ form.expire_time.help_text }}</div>
                        {% if form.expire_time.errors %}
                            <div class="text-danger mt-2">
                                {{ form.expire_time.errors }}
                            </div>
                        {% endif %}
                    </div>

                    <!-- 提交按钮 -->
                    <div class="text-center">
                        <button type="submit" class="btn btn-primary btn-lg px-5" id="submitBtn">
                            <i class="bi bi-play-circle"></i> 生成语音
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- 最近记录 -->
    {% if recent_records %}
    <div class="row mt-5">
        <div class="col-12">
            <h3 class="text-gradient mb-3">
                <i class="bi bi-clock-history"></i> 最近生成
            </h3>
            <div class="row">
                {% for record in recent_records %}
                <div class="col-md-6 col-lg-4 mb-3">
                    <div class="card">
                        <div class="card-body">
                            <h6 class="card-title">
                                <span class="badge badge-custom {% if record.tts_type == 'local' %}bg-info{% else %}bg-primary{% endif %}">
                                    {{ record.get_tts_type_display }}
                                </span>
                            </h6>
                            <p class="card-text text-truncate">{{ record.text }}</p>
                            <small class="text-muted">{{ record.uptime|date:"Y-m-d H:i" }}</small>
                            <div class="mt-2">
                                <a href="{% url 'result' record.id %}" class="btn btn-sm btn-outline-primary">
                                    <i class="bi bi-eye"></i> 查看
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>
    {% endif %}
</div>

{% endblock %}

{% block extra_js %}
<script>
document.getElementById('ttsForm').addEventListener('submit', function(e) {
    const btn = document.getElementById('submitBtn');
    btn.disabled = true;
    btn.innerHTML = '<span class="spinner-border spinner-border-sm me-2"></span>生成中，请稍候...';
});
</script>
{% endblock %}

